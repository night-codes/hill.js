function getTextWidthDOM(a,b){var c=document.querySelector("#widthchecker");return c||(c=document.createElement("span"),c.style.cssText="position:absolute;left:-3000px;font:"+b+";float:left;white-space:nowrap;",c.setAttribute("id","widthchecker"),document.body.appendChild(c)),c.textContent=a,{width:c.clientWidth,height:c.clientHeight}}function extend(a){if(!arguments[1])return a;for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a}function Hill(a,b,c,d){var e=this;if("string"==typeof a&&(a=document.querySelector(a)),a.get&&!a.getContext&&(a=a.get(0)),!a||!a.getContext)throw"Canvas not found!";if(!Array.isArray(b))throw"Series must be array!";this.canvas=a,this.pixelRatio=window&&window.devicePixelRatio||1,this.ctx=a.getContext("2d"),this.series=b,this.drawSeries=[],this.options=extend({type:"line",YAxisMinSize:60,XAxisMinStep:1,XAxisMinSize:80,drawYAxis:!0,drawXAxis:!0,from:0,to:0,lineWidth:1,dotInterval:1,gridFontColor:"#444444",gridColor:"#999999",strokeStyle:"#eeeeee",fillStyle:"#ffffff",indentTop:40,indentBottom:40,infoX:function(a){return a},infoY:function(a){return Number(a.toFixed(4))},ft:{f:.3,t:.5}},c),this.geometry=extend({x:0,y:0,width:this.canvas.clientWidth,height:this.canvas.clientHeight},d),this.buffer=document.createElement("canvas"),this.buffer.ctx=this.buffer.getContext("2d"),this.lastSizes={height:0,width:0},this.hht=1,this.center=(this.geometry.height-30)/2,this.getX=function(a,b){return 0},this.getXRound=function(a,b){return 0},this.setX=function(a,b){return 0},this.roundX=function(a,b){e.drawSeries[a];return e.getXRound(a,e.setX(a,b))},e.getEl=function(a,b){var d=(e.drawSeries[a],e.setX(a,b)),f=e.getXRound(a,d);return{el:e.drawSeries[a].data[f]||null,"real-x":f,x:b,dataIdx:d}},this.resizeCanvas=function(){e.ctx.canvas.width=e.canvas.clientWidth*e.pixelRatio,e.ctx.canvas.height=e.canvas.clientHeight*e.pixelRatio,1!==e.pixelRatio&&e.ctx.scale(e.pixelRatio,e.pixelRatio)},this.resizeBuffer=function(){e.lastSizes.width==e.geometry.width&&e.lastSizes.height==e.geometry.height||(e.buffer.width=e.geometry.width*e.pixelRatio,e.buffer.height=e.geometry.height*e.pixelRatio,1!==e.pixelRatio&&e.buffer.ctx.scale(e.pixelRatio,e.pixelRatio),e.lastSizes.width=e.geometry.width,e.lastSizes.height=e.geometry.height),e.buffer.ctx.lineWidth=e.options.lineWidth},this.updateData=function(){var a=[],b=e.options;e.max=-Math.pow(10,100),e.min=Math.pow(10,100),e.series.forEach(function(c,d){var f=extend({type:"line",fillEmpty:!1,allowZero:!0,strokeStyle:"#2B4D8C",fillStyle:null,strokeStyle2:"#7C272A",fillStyle2:null,strokeStyle3:"#4B4B4B",fillStyle3:null,dotInterval:b.dotInterval,type:b.type},c,{data:[]});"number"!=typeof f.lineWidth&&(f.lineWidth=b.lineWidth),"undefined"==typeof f.ft&&(f.ft=b.ft),"number"!=typeof f.dotInterval&&(f.dotInterval=f.lineWidth),"column"===f.type||"columnbar"===f.type||"columnrange"===f.type?f.dotInterval=Math.max(f.dotInterval,6):"candlestick"!==f.type&&"bar"!==f.type||(f.dotInterval=Math.max(f.dotInterval,13)),f.dotInterval=Math.round(f.dotInterval);for(var g in c.data){var h=c.data[g];g>=b.from-1-f.dotInterval&&g<=b.to+1+f.dotInterval&&("number"==typeof h?h={max:h,min:h,actual:h}:Array.isArray(h)&&(h=1===h.length?{max:h[0],min:h[0],actual:h[0]}:{max:Math.max.apply(null,h),min:Math.min.apply(null,h),actual:h[h.length-1]}),(f.allowZero||0!=h.actual)&&("column"===f.type||"line"===f.type?(e.max=Math.max(h.actual,e.max),e.min=Math.min(h.actual,e.min)):(e.max=Math.max(h.max,e.max),e.min=Math.min(h.min,e.min)),f.data[g]=h))}f.step=(b.to-b.from)/Math.round(e.geometry.width/f.dotInterval),f.roundedFrom=Math.ceil(b.from-b.from%f.step),f.drawbias=(f.roundedFrom-b.from)/f.step,f.bias=f.roundedFrom/f.step,a.push(f)}),e.hht=(e.geometry.height-e.options.indentTop-e.options.indentBottom)/(e.max-e.min),e.center=e.geometry.height-e.options.indentBottom+e.hht*e.min,e.getX=function(b,c){var d=a[b];return((Math.ceil(c/d.step)-d.bias+d.drawbias)*d.dotInterval).fix6()},e.getXRound=function(b,c){var d=a[b];return((Math.round(c/d.step)-d.bias+d.drawbias)*d.dotInterval).fix6()},e.setX=function(b,c){var d=a[b];return Math.round((c/d.dotInterval+d.bias-d.drawbias)*d.step)},"function"==typeof e.options.afterNormalize&&e.options.afterNormalize(),e.drawSeries=[],a.forEach(function(a,b){for(var c=null,d=e.options,f=a.data,g={},h=a.roundedFrom-1;h<=d.to;h++){var i=e.getX(b,h);"undefined"==typeof f[h]||0===f[h].actual&&!a.allowZero?(g[i]||a.fillEmpty||(g[i]=null),c=null):(g[i]?g[i]={actual:f[h].actual.fix6(),max:Math.max(g[i].max,f[h].max,f[h].actual),min:Math.min(g[i].min,f[h].min,f[h].actual),open:"number"==typeof g[i].open?g[i].open:"number"==typeof c?c:g[i].actual}:g[i]={actual:f[h].actual.fix6(),max:Math.max(f[h].max,f[h].actual),min:Math.min(f[h].min,f[h].actual),open:"number"==typeof f[h].open?f[h].open:"number"==typeof c?c:f[h].actual},g[i].max=Math.max(g[i].max,g[i].open).fix6(),g[i].min=Math.min(g[i].min,g[i].open).fix6(),c=f[h].actual.fix6())}var j={};for(key in a)j[key]=a[key];j.data=g,e.drawSeries.push(j)})},this.draw=function(){var a=e.buffer.ctx;e.resizeBuffer(),a.fillStyle=e.options.fillStyle,a.fillRect(0,0,e.geometry.width,e.geometry.height),a.fill(),e.options.drawYAxis&&e.drawYAxis(),e.options.drawXAxis&&e.drawXAxis(),e.drawSeries.forEach(function(a){window.hilldraws[a.type](e,a)}),e.ctx.drawImage(e.buffer,e.geometry.x,e.geometry.y,e.geometry.width,e.geometry.height),e.options.strokeStyle&&(e.ctx.strokeStyle=e.options.strokeStyle,e.ctx.strokeRect(e.geometry.x,e.geometry.y,e.geometry.width,e.geometry.height))},this.redraw=function(){"function"==typeof e.options.beforeUpdate&&e.options.beforeUpdate(),e.updateData(),"function"==typeof e.options.afterUpdate&&e.options.afterUpdate(),e.draw(),"function"==typeof e.options.afterDraw&&e.options.afterDraw()},this.getY=function(a){return Math.round(e.center-a*e.hht)},this.setY=function(a){return(e.center-a)/e.hht},this.drawYAxis=function(){var a=e.buffer.ctx,b=e.options,c=b.YAxisMinSize,d=5e-5;for(a.font="bold 10px 'Open Sans', sans-serif",a.textBaseline="middle",a.textAlign="end",i=0;i<100&&(d=Number((Math.pow(10,i)/1e5).toFixed(6)),!(d*e.hht>=c))&&(d*=2,!(d*e.hht>=c))&&(d*=1.25,!(d*e.hht>=c))&&(d*=2,!(d*e.hht>=c))&&(d*=1.25,!(d*e.hht>=c));i++);for(var f=e.min-e.min%d-d,g=e.max+d,h=f;h<=g;h+=d)if(h>=e.min+10/e.hht&&h<=e.max-10/e.hht){var j=b.infoY(h),k=getTextWidthDOM(j,a.font).width;a.lineWidth=1,a.fillStyle=b.gridFontColor,a.fillText(j,e.geometry.width-10,e.getY(h)),a.fillStyle=b.gridColor,a.fillRect(0,e.getY(h)-1,e.geometry.width-k-20,1)}},this.drawXAxis=function(){var a=e.buffer.ctx;a.font="bold 10px 'Open Sans', sans-serif",a.textBaseline="middle",a.textAlign="end";for(var b=e.options,c=e.geometry.width/(b.to-b.from),d=c*b.XAxisMinStep;d<b.XAxisMinSize;)d*=2;for(var f=b.from*c%d,g=-f;g<=e.geometry.width-20;g+=d){var h=b.infoX(e.setX(0,g)),i=getTextWidthDOM(h,a.font);a.lineWidth=1,a.fillStyle=b.gridFontColor,a.fillText(h,g+i.width/2-1,e.geometry.height-10),a.fillStyle=b.gridColor,a.fillRect(g-1,0,1,e.geometry.height-i.height-20)}},this.resizeCanvas()}function gradient(a,b){return(b.y-a.y)/(b.x-a.x)}Number.prototype.fix6=function(){return Number(this.toFixed(6))},window.hilldraws={},window.hilldraws.line=function(a,b){function m(b,c){j&&(b.beginPath(),b.moveTo(c.x,a.getY(c.y)),l=c,k=c.x,j=!1)}function n(b){j||(b.stroke(),b.lineTo(l.x,a.getY(l.y)),b.lineTo(l.x,a.geometry.height),b.lineTo(k,a.geometry.height),b.closePath(),b.fill(),j=!0)}var c=a.buffer.ctx;if(b.fillStyle&&(c.fillStyle=b.fillStyle,b.fillStyle2)){var d=c.createLinearGradient(0,0,0,1.4*a.geometry.height);d.addColorStop(0,b.fillStyle),d.addColorStop(1,b.fillStyle2),c.fillStyle=d}c.strokeStyle=b.strokeStyle,c.lineWidth=b.lineWidth;var e=b.data,f=Object.keys(b.data).map(function(a){return Number(a)}).sort(function(a,b){return a-b}),g=0,h=0,i=0,j=!0,k=0,l={x:0,y:a.geometry.height};f.forEach(function(d,j){if(e[d]){var k={x:d,y:Number(e[d].actual)};m(c,k),f[j+1]&&e[f[j+1]]?(nexP={x:f[j+1],y:Number(e[f[j+1]].actual)},g=gradient(l,nexP),dx2=(nexP.x-k.x)*-b.ft.f,dy2=dx2*g*b.ft.t):(dx2=0,dy2=0),k.x<0&&c.moveTo(k.x,a.getY(k.y)),c.bezierCurveTo(l.x-h,a.getY(l.y-i),k.x+dx2,a.getY(k.y+dy2),k.x,a.getY(k.y)),h=dx2,i=dy2,l=k}else null===e[d]&&n(c,l)}),n(c,l)},window.hilldraws.column=function(a,b){var c=a.buffer.ctx;c.fillStyle=b.fillStyle||b.strokeStyle;var f,g,d=b.data,e=Object.keys(b.data).map(function(a){return Number(a)}).sort(function(a,b){return a-b});e.forEach(function(e,h){if(null!==d[e]&&g){f=e-g;var i=[e-f/2+1.2,a.getY(Number(d[e].actual)),f-2.4,a.getY(a.min)-a.getY(Number(d[e].actual))];c.fillRect.apply(c,i),b.strokeStyle&&(c.lineWidth=1,c.strokeStyle=b.strokeStyle,c.strokeRect.apply(c,i))}g=e})},window.hilldraws.columnrange=function(a,b){var c=a.buffer.ctx;c.fillStyle=b.fillStyle||b.strokeStyle;var f,g,d=b.data,e=Object.keys(b.data).map(function(a){return Number(a)}).sort(function(a,b){return a-b});e.forEach(function(e,h){if(null!==d[e]&&g){f=e-g;var i=Math.max(Math.abs(a.getY(d[e].max)-a.getY(d[e].min)),1),j=[e-f/2+1.2,a.getY(d[e].max),f-2.4,i,1];c.fillRect.apply(c,j),b.strokeStyle&&(c.lineWidth=1,c.strokeStyle=b.strokeStyle,c.strokeRect.apply(c,j))}g=e})},window.hilldraws.columnbar=function(a,b){var f,g,c=a.buffer.ctx,d=b.data,e=Object.keys(b.data).map(function(a){return Number(a)}).sort(function(a,b){return a-b});e.forEach(function(e,h){if(c.fillStyle=b.fillStyle||b.strokeStyle,null!==d[e]&&g){f=e-g;var i=a.getY(Math.max(d[e].open,d[e].actual)),j=Math.max(Math.abs(a.getY(d[e].open)-a.getY(d[e].actual)),1);d[e].open>d[e].actual&&(c.fillStyle=b.fillStyle2||b.strokeStyle2);var k=[e-f/2+1.2,i,f-2.4,j,1];c.fillRect.apply(c,k),b.strokeStyle&&(c.lineWidth=1,c.strokeStyle=b.strokeStyle,d[e].open>d[e].actual&&(c.strokeStyle=b.strokeStyle2||b.strokeStyle),c.strokeRect.apply(c,k))}g=e})},window.hilldraws.candlestick=function(a,b){var c=a.buffer.ctx;c.fillStyle=b.fillStyle||b.strokeStyle;var f,g,d=b.data,e=Object.keys(b.data).map(function(a){return Number(a)}).sort(function(a,b){return a-b});e.forEach(function(e,h){var i=d[e];if(null!==i&&g){f=e-g;var j=a.getY(Math.max(i.open,i.actual)),k=Math.max(Math.abs(a.getY(i.open)-a.getY(i.actual)),1);i.open>i.actual?c.fillStyle=b.fillStyle2||b.strokeStyle2:i.open<i.actual&&(c.fillStyle=b.fillStyle||b.strokeStyle);var l=a.getY(Math.max(i.max,i.min)),m=Math.max(Math.abs(a.getY(i.max)-a.getY(i.min)),1),n=Math.round(.65*f),o=Math.round(.05*f);c.fillRect(e-n/2,j,n,k,1),c.fillRect(e-o/2,l,o,m,1)}g=e})},window.hilldraws.bar=function(a,b){var c=a.buffer.ctx;c.fillStyle=b.fillStyle||b.strokeStyle;var f,g,d=b.data,e=Object.keys(b.data).map(function(a){return Number(a)}).sort(function(a,b){return a-b});e.forEach(function(e,h){var i=d[e];if(null!==i&&g){f=e-g,i.open>i.actual?c.fillStyle=b.fillStyle2||b.strokeStyle2:i.open<i.actual&&(c.fillStyle=b.fillStyle||b.strokeStyle);var j=Math.max(Math.abs(a.getY(i.max)-a.getY(i.min)),1),k=Math.max(6,Math.round(.4*f)),l=Math.min(3,Math.round(.13*f));c.fillRect(e-k+l/2,a.getY(i.open)-.8,k,1.6,1),c.fillRect(e-l/2,a.getY(i.actual)-.8,k,1.6,1),c.fillRect(e-l/2,a.getY(i.max),l,j,1)}g=e})};